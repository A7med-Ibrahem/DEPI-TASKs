CREATE TABLE DEPARTMENT (
    DNUM INT PRIMARY KEY,
    DName VARCHAR(50) NOT NULL UNIQUE,
    ManagerSSN CHAR(9),
    ManagerHireDate DATE
);

CREATE TABLE EMPLOYEE (
    SSN CHAR(9) PRIMARY KEY,
    Fname VARCHAR(50) NOT NULL,
    Lname VARCHAR(50) NOT NULL,
    BirthDate DATE NOT NULL,
    Gender CHAR(1) CHECK (Gender IN ('M','F')),
    SupervisorSSN CHAR(9),
    DNUM INT NOT NULL
);

CREATE TABLE PROJECT (
    PNumber INT PRIMARY KEY,
    PName VARCHAR(50) NOT NULL,
    LocationCity VARCHAR(50),
    DNUM INT NOT NULL
);

CREATE TABLE WORKS_ON (
    SSN CHAR(9),
    PNumber INT,
    WorkingHours DECIMAL(5,2) NOT NULL,
    PRIMARY KEY (SSN, PNumber)
);

CREATE TABLE DEPENDENT (
    SSN CHAR(9),
    DependentName VARCHAR(50),
    Gender CHAR(1) CHECK (Gender IN ('M','F')),
    BirthDate DATE,
    PRIMARY KEY (SSN, DependentName)
);

ALTER TABLE EMPLOYEE
ADD CONSTRAINT FK_Employee_Department
FOREIGN KEY (DNUM) REFERENCES DEPARTMENT(DNUM);

ALTER TABLE EMPLOYEE
ADD CONSTRAINT FK_Employee_Supervisor
FOREIGN KEY (SupervisorSSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE DEPARTMENT
ADD CONSTRAINT FK_Department_Manager
FOREIGN KEY (ManagerSSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE PROJECT
ADD CONSTRAINT FK_Project_Department
FOREIGN KEY (DNUM) REFERENCES DEPARTMENT(DNUM);

ALTER TABLE WORKS_ON
ADD CONSTRAINT FK_WorksOn_Employee
FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE WORKS_ON
ADD CONSTRAINT FK_WorksOn_Project
FOREIGN KEY (PNumber) REFERENCES PROJECT(PNumber);

ALTER TABLE DEPENDENT
ADD CONSTRAINT FK_Dependent_Employee
FOREIGN KEY (SSN) REFERENCES EMPLOYEE(SSN)
ON DELETE CASCADE;

INSERT INTO DEPARTMENT VALUES
(1,'IT',NULL,NULL),
(2,'HR',NULL,NULL),
(3,'Finance',NULL,NULL);

INSERT INTO EMPLOYEE VALUES
('111111111','Ahmed','Ali','1990-01-01','M',NULL,1),
('222222222','Sara','Hassan','1992-05-10','F','111111111',1),
('333333333','Omar','Youssef','1988-03-15','M','111111111',2),
('444444444','Mona','Khaled','1995-07-20','F','333333333',2),
('555555555','Youssef','Adel','1993-11-30','M','333333333',3);

UPDATE DEPARTMENT
SET ManagerSSN = '111111111', ManagerHireDate = '2015-01-01'
WHERE DNUM = 1;

UPDATE DEPARTMENT
SET ManagerSSN = '333333333', ManagerHireDate = '2016-03-01'
WHERE DNUM = 2;

UPDATE DEPARTMENT
SET ManagerSSN = '555555555', ManagerHireDate = '2017-06-01'
WHERE DNUM = 3;

INSERT INTO PROJECT VALUES
(10,'Website','Cairo',1),
(20,'Recruitment System','Giza',2),
(30,'Accounting System','Alex',3);

INSERT INTO WORKS_ON VALUES
('111111111',10,20),
('222222222',10,15),
('333333333',20,25),
('444444444',20,10),
('555555555',30,30);

INSERT INTO DEPENDENT VALUES
('111111111','Ali','M','2015-05-01'),
('111111111','Mariam','F','2018-08-10'),
('333333333','Yara','F','2017-09-15');

UPDATE EMPLOYEE
SET DNUM = 3
WHERE SSN = '222222222';

DELETE FROM DEPENDENT
WHERE SSN = '111111111' AND DependentName = 'Ali';

SELECT E.*
FROM EMPLOYEE E
JOIN DEPARTMENT D ON E.DNUM = D.DNUM
WHERE D.DName = 'IT';

SELECT 
    E.Fname + ' ' + E.Lname AS EmployeeName,
    P.PName,
    W.WorkingHours
FROM EMPLOYEE E
JOIN WORKS_ON W ON E.SSN = W.SSN
JOIN PROJECT P ON W.PNumber = P.PNumber;